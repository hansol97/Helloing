<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">
	
	<resultMap id="memberResultSet" type="member">
		<result column="MEM_NO"			property="memNo" />
		<result column="MEM_ID" 		property="memId" />
		<result column="MEM_PWD" 		property="memPwd" />
		<result column="MEM_NAME" 		property="memName" />
		<result column="EMAIL" 			property="email" />
		<result column="PHONE" 			property="phone" />
		<result column="STATUS" 		property="status" />
		<result column="MEM_ENROLLDATE" property="memEnrollDate" />
		<result column="REPORT_COUNT" 	property="reportCount" />
	</resultMap>

	<select id="loginMember" parameterType="member" resultMap="memberResultSet">
		select
				mem_no,
				mem_id,
				mem_pwd,
				mem_name,
				email,
				phone,
				status,
				mem_enrolldate,
				report_count
		 from
		 		member
		where
				mem_id = #{memId}
		  and
		  		(status = 'Y' or status = 'A')
	</select>
	
	<insert id="insertMember" parameterType="member">
		insert
		  into
		  		member
		  		(
		  		mem_no,
		  		mem_id,
		  		mem_pwd,
		  		mem_name,
		  		email,
		  		phone
		  		)
		values
				(
				seq_memNo.nextval,
				#{ memId },
				#{ memPwd },
				#{ memName },
				#{ email },
				#{ phone }
				)
	</insert>	
	
	
	
	
	
	
	
	<!-- 여기부터 혜진 -->
	<select id="checkPwd" parameterType="member" resultType="string">
	SELECT 
			MEM_PWD
	FROM
		MEMBER
	WHERE 
		MEM_ID = #{ memId }
	</select>
	<update id="memberUpdatePwd" parameterType="member">
		UPDATE 
			  MEMBER
		SET
			MEM_PWD = #{ memPwd }
		WHERE 
			MEM_ID = #{ memId }
	</update>
	<update id="memberUpdate" parameterType="member">
		UPDATE 
			  MEMBER
		SET
			EMAIL = #{ email },
			PHONE = #{ phone }
		WHERE 
			MEM_ID = #{ memId }
	</update>
	<select id="wishAccommList" parameterType="_int" resultType="AccommWish">
		SELECT 
        		ACCOMM_NO accommNo,
        		ACCOMM_NAME accommName,
       			FILE_PATH || CHANGE_NAME AS FILEPATH
		FROM 
			ACCOMM_WISH
		JOIN 
			ACCOMM USING(ACCOMM_NO)
		JOIN 
			ACCOMM_ATTACHMENT USING(ACCOMM_NO)
		WHERE 
			MEM_NO = #{ memNo }
		ORDER 
			BY 
				WISH_DATE DESC
	</select>
	<delete id="deleteWishAccomm"  parameterType="accommwish">
	DELETE 
			ACCOMM_WISH 
		WHERE
			MEM_NO = #{ memNo }
		AND
			ACCOMM_NO = #{ accommNo }
	</delete>
	<select id="wishActivityList" parameterType="_int" resultType="ActivityWish">
			SELECT 
        		ACTIVITY_NO activityNo,
        		ACTIVITY_NAME activityName,
       			FILE_PATH || CHANGE_NAME AS FILEPATH
		FROM 
			ACTIVITY_WISH
		JOIN 
			ACTIVITY USING(ACTIVITY_NO)
		JOIN 
			ACTIVITY_ATTACHMENT USING(ACTIVITY_NO)
		WHERE 
			MEM_NO = #{ memNo }
		ORDER 
			BY 
				WISH_DATE DESC
	</select>
	<delete id="deleteWishActivity" parameterType="activitywish">
		DELETE 
			ACTIVITY_WISH 
		WHERE
			MEM_NO = #{ memNo }
		AND
			ACTIVITY_NO = #{ activityNo }
	</delete>
	<select id="plannerList" parameterType="_int" resultType="planner">
	SELECT 
		PLANNER_NO plannerNo, 
		PLANNER_NAME plannerName, 
		TO_CHAR(START_DATE, 'YY/MM/DD') startDate,
		TO_CHAR(END_DATE,'YY/MM/DD') endDate 
	FROM 
		PLANNER
	JOIN 
		PLANNER_MEM USING(PLANNER_NO)
	WHERE 
		MEM_NO = #{ memNo }
	ORDER 
		BY 
			START_DATE DESC
	</select>
	<insert id="insertPlanner" parameterType="planner">
		INSERT 
				INTO 
					PLANNER 
			VALUES (
					SEQ_PLANNO.NEXTVAL
					, #{ plannerName }
					, #{ startDate }
					, #{ endDate }
					)
	</insert>
	<insert id="insertPlannerMem" parameterType="_int">
		INSERT 
				INTO
					PLANNER_MEM
			VALUES	(
					SEQ_PLANNO.CURRVAL
					, #{ memNo }
					)
	</insert>
	
</mapper>
